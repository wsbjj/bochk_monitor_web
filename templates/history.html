<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>监控历史</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .navbar { background-color: #0f2d52 !important; }
    .navbar-brand { font-weight: bold; font-size: 1.3rem; }
    table { font-size: 0.95rem; }
    tbody tr:hover { background-color: #f8f9fa; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">中银香港预约监控</a>
    </div>
  </nav>

  <div class="container-fluid mt-4" style="max-width: 1200px;">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">监控历史记录</h5>
      </div>
      <div class="card-body">
        <a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm mb-3">← 返回状态页</a>
        <div class="table-responsive">
          <table class="table table-hover table-sm">
            <thead class="table-light">
              <tr>
                <th>检查时间</th>
                <th>可预约数量</th>
                <th>可预约日期</th>
                <th>eaiCode</th>
                <th>错误信息</th>
              </tr>
            </thead>
            <tbody>
              {% for item in history %}
              <tr>
                <td><small>{{ item.checked_at }}</small></td>
                <td>
                  {% if item.available_num is not none %}
                    <span class="badge {% if item.available_num > 0 %}bg-success{% else %}bg-secondary{% endif %}">
                      {{ item.available_num }}
                    </span>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td>
                  {% if item.available_list %}
                    <small>{{ item.available_list | join(', ') }}</small>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td><small>{{ item.eai_code or '-' }}</small></td>
                <td>
                  {% if item.error %}
                    <span class="text-danger text-truncate" title="{{ item.error }}" style="display: block; max-width: 200px;">
                      <small>{{ item.error }}</small>
                    </span>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
              {% if not history %}
              <tr>
                <td colspan="5" class="text-center text-muted py-4">暂无记录</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
        <small class="text-muted">{{ history | length }} 条记录</small>
      </div>
    </div>
  </div>

  <footer class="text-center text-muted mt-5 mb-4">
    <small>中银香港预约监控系统 v1.0</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
